---
layout:     post
title:      Android 串口开发
subtitle:   android-serialport-api
date:       2025-08-01
author:     LXG
header-img: img/post-bg-android.jpg
catalog: true
tags:
    - Android
    - 硬件
---

[android-serialport-api](https://github.com/cepr/android-serialport-api)

[Android-SerialPort-API](https://github.com/licheedev/Android-SerialPort-API)

[凯晟电子](https://www.szksdz.com/index.php/%e9%a1%b9%e7%9b%ae%e8%af%a6%e6%83%85/)

## 锁控板硬件设计

[STC8AK64-LOCK-66](https://gitee.com/tangwei_509/STC8AK64-LOCK-66)

| 功能区域 | 功能说明 |
|----------|----------|
| **锁线接口（Lock Ports）** | 控制多个电磁锁的通断，图中有 24 个插座 |
| **拨码器（DIP Switch）** | 设置地址或工作模式，便于多板级联或功能配置 |
| **信号线接口** | 接收上位机指令，如 RS485、串口等 |
| **级联线接口** | 多个锁控板之间的数据通信连接接口 |
| **电源接口** | 提供整个电路所需电压电流，估计为 DC 12V |
| **调试按钮** | 提供测试功能，如逐门开锁、全开、重复开门等 |

![xintian_lock](/images/hardware/xintian/xintian_lock.png)

## 锁控板功率

```txt

  电源正极
     |
+----+----+----+----+----+
|    |    |    |    |    |
板1 板2 板3 板4 板5 …… 板9
|    |    |    |    |    |
+----+----+----+----+----+
     |
  电源负极

```

**级联（串联连接多块锁控板）确实可能导致电压下降, 一般 12V 电源只能带 9 块儿锁控板**

| 原因            | 说明                                      |
| ------------- | --------------------------------------- |
| **电源线电阻压降**   | 线路越长，电流越大，导线阻抗越高，压降越明显（尤其是用细线时）         |
| **串联供电布局不合理** | 多块板子级联但供电仍从首板一路穿过去，后端板电压偏低              |
| **电源带载能力不足**  | 电源功率或电流不足时，加载越多电压越掉，表现为“越后级的锁控板越不稳定”    |
| **地线/信号回路压降** | GND 回路不良也会导致控制信号漂移或电压偏移，造成“看起来像供电问题”的假象 |

**锁控板功耗**

20mA

**电磁锁功率**

| 阶段       | 电流值（典型）        | 时间段       |
| -------- | -------------- | --------- |
| 吸合瞬间     | **1.2A \~ 2A** | 几毫秒\~几十毫秒 |
| 稳态维持吸合电流 | 0.15A \~ 0.5A  | 持续工作期     |

单独开一把锁的瞬时最大电流 1.2A
同时开两把锁的瞬时最大电流 1.4A

因此10块儿锁控制板级联至少需要2A的适配器，考虑余额，应该配置3A的适配器

10寸屏幕的瞬时电流为600mA, 接喇叭或者USB相机后功率会提升，因此也需要2A的适配器

21寸屏幕的瞬时电流为2.1A， 接喇叭或者USB相机后至少需要3A的适配器

**总结:**

* 10寸屏幕快递柜系统至少需要12V 4A的适配器
* 21寸屏幕快递柜系统至少需要12V 5A的适配器

### 导通时间

**什么是导通时间**

锁控板的“导通时间”，通常是指控制电磁锁（或电机锁）通电保持的持续时间，即锁保持打开状态的时间，在电子控制中也叫：

* 锁通电时间
* 开锁保持时间
* 开锁脉冲时间（pulse time）

假设你的智能柜使用的是 12V 电磁锁，当 MCU 控制 MOSFET 导通、或者给继电器一个高电平时：

* 锁控板会给锁供电，此时锁芯被吸合，柜门可以打开；
* 导通时间设为 1000ms（1秒），表示锁保持开锁状态 1 秒后自动断电。

**为什么需要设置导通时间？**

锁控板的导通时间就是锁被“打开/通电”的持续时间，过短会打不开，过长可能烧锁或浪费电，一般通过软件或协议灵活控制

### 电气设计注意事项

| 项目 | 注意事项 |
|------|----------|
| 反向电压保护 | 每个锁控通道并联肖特基二极管（如 SS14）防止电磁锁断电时反灌烧毁驱动 |
| MOSFET/继电器选型 | 电流≥锁额定电流的2倍；推荐 IRF540N / AO3400 |
| 持续通电保护 | 锁开启时间应控制在 300~500ms，避免过热 |
| 电源功率设计 | 根据锁数量估算，推荐 ≥ 总电流 × 1.5 的裕量 |
| 过流保护 | 电源入口或锁控通道加保险丝 / PPTC 自恢复保险 |
| 地线布线 | 地线粗短回路，防止锁动作引起 MCU 浮地或干扰 |
| 通信接口保护 | RS485 加 TVS 管防浪涌；通信端加终端匹配电阻 |
| EMC 抗干扰 | 强电与弱电分区布局；锁控开关加滤波和电容保护 |


### 固件与协议设计注意事项

| 项目 | 注意事项 |
|------|----------|
| 开锁控制 | 每个锁开启时间控制在 300~500ms，防止持续通电 |
| 通信协议设计 | 自定义帧结构（帧头 + 地址 + 命令 + 数据 + 校验）或使用 Modbus RTU |
| 超时与错误处理 | 命令超时自动清除；非法指令无响应但记录日志 |
| 地址管理 | 拨码开关设定地址，固件读取后匹配指令 |
| 指令防误触 | 所有命令都加校验（如 CRC-8）确保完整性 |
| 调试功能 | 支持单门测试、逐门轮测、全部开锁等调试指令 |
| 自检机制 | MCU 启动后自动检测锁输出通道、电源状态 |
| 看门狗机制 | 避免 MCU 死机导致锁控失效，使用 WDG 保活 |

## 双线锁

![dual_line_lock](/images/hardware/xintian/dual_line_lock.jpg)

![taobao_lock](/images/hardware/xintian/taobao_lock.jpg)

## BCC 校验

BCC（Block Check Character） 是一种简单的数据完整性校验方式，常用于低速数据传输（如串口、RFID、485 总线通信），判断数据包在传输过程中是否发生错误

BCC = 所有数据字节按位异或（XOR）, 一般协议头和协议尾是不参与校验的

```txt

80 01 01 33

| 值    | 二进制       |
| ---- | --------- |
| 0x80 | 1000 0000 |
| 0x01 | 0000 0001 |
| 0x01 | 0000 0001 |
| 0x33 | 0011 0011 |



  1000 0000
⊕ 0000 0001
= 1000 0001   (0x81)

  1000 0001
⊕ 0000 0001
= 1000 0000   (0x80)

  1000 0000
⊕ 0011 0011
= 1011 0011   (0xB3)

80 01 01 33 BCC校验后的值是B3

```

## UPS 不间断电源

[普迪斯顿UPS](http://www.pudsd.com/Products/akseriesak.html)

UPS（Uninterruptible Power Supply）不间断电源 是一种在市电停电或电压波动时，能够立即提供稳定电力的设备，防止电子设备因为断电而出现数据丢失、硬件损坏等问题。

| 功能          | 说明                               |
| ----------- | -------------------------------- |
| **持续供电**    | 市电断电时立即切换到电池供电，保证设备不中断运行         |
| **稳压调压**    | 对电网的电压波动进行滤波、稳压，保护设备免受电压过高或过低的影响 |
| **过载/短路保护** | 避免负载过大或短路时烧毁主设备或电池               |
| **备用时间**    | 根据电池容量，提供几分钟到几小时的应急供电时间          |

“后备式 UPS” 也叫 离线式 UPS（Offline UPS），是 UPS 不间断电源中最常见、最基础的一种类型。

不间断电源 (UPS) 分为两大类：在线 UPS 和离线 UPS。这两种类型有几个明显的区别。最明显的区别是，在线 UPS 直接连接到交流主电源，并从那里为电池充电，而离线 UPS 只有在主电源波动或停电时才会连接到其他系统。从根本上说，在线 UPS 可提供无切换时间的后备电源，而离线 UPS 则需要很短的切换时间。因此，医疗设备或服务器等需要持续供电的应用通常使用在线式 UPS 系统，而价格较低的离线式 UPS 系统则主要用于办公室和家庭。

![Standby_UPS_Diagram](/images/hardware/xintian/Standby_UPS_Diagram.png)

```plaintext

           正常状态（市电正常）：
          ┌────────────┐
  市电 ───▶ 负载（电脑等） │
          └────────────┘
                 │
             UPS 电池在后台待命

           市电异常（停电/过压）：
              ┌─────────────┐
电池供电 ───▶ UPS 逆变器  ───▶ 负载
              └─────────────┘

```

PD1000‑1000VA/600W 这类 UPS（一般为 1000VA/600W 规格）：

* 输入电压：220 V、230 V 或 240 V AC，频率常见为 50/60 Hz
* 输出电压：AC 输出通常是稳定的 230 V AC（±10%），频率为 50 Hz 或 60 Hz 

| 项目       | 参数                       |
| -------- | ------------------------ |
| 电池组      | **12V 9Ah × 2 串联 = 24V** |
| 总能量      | 24V × 9Ah = **216Wh**    |
| UPS 转换效率 | 通常在 80% \~ 90%           |


| 负载功率    | UPS续航时间（估算）        |
| ------- | ------------------ |
| 10W     | ≈ 18 小时 ✅          |
| **24W** | ≈ **7.6 小时** ✅一个主柜情况 |
| 50W     | ≈ 3.6 小时           |
| 100W    | ≈ 1.8 小时           |









