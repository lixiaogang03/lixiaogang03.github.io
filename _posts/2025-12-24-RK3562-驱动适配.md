---
layout:     post
title:      RK3562 驱动适配
subtitle:   基于明远智睿开发板
date:       2025-12-24
author:     LXG
header-img: img/post-bg-sky.jpg
catalog: true
tags:
    - rk3562
---

## 驱动配置文件

device/rockchip/.chips/rk3562/myzr_rk3562_evb_defconfig

```sh

# SPL 是 U-Boot 的二级引导程序，主要负责初始化 DDR、加载完整的 U-Boot 镜像
RK_UBOOT_SPL=y

# 内核设备树文件名
RK_KERNEL_DTS_NAME="myzr-rk3562-evb"

# 指定 分区表或参数文件
RK_PARAMETER="parameter-buildroot-fit.txt"

# 使用 FIT 格式镜像（Flattened Image Tree）
# FIT 镜像可以把 kernel、device tree、ramdisk 等整合成一个镜像文件
RK_USE_FIT_IMG=y

```

## 驱动配置

```c

/dts-v1/;

#include "rk3562-evb2-ddr4-v10.dtsi"
#include "rk3562-linux.dtsi"
#include "rk3562-rk809.dtsi"
#include "rk3562-amp.dtsi"

/ {
	model = "MYZR-RK3562-EVB";
};


```

### rk3562-amp.dtsi

**AMP（Asymmetric Multi Processing）**

* RK3562 是 异构多核 SoC，除了主应用 CPU 核（A53/A55），还可能有 MCU 或辅助小核（CM0）
* AMP 机制允许 独立 CPU/核运行不同操作系统或任务，通过共享内存和消息通信协作
* 这里的 rockchip_amp 节点就是配置 辅助 MCU 核心（CM0）或 AMP CPU 核）

**RPMsg（Remote Processor Messaging）**

* ARM SoC 常用的 CPU 与 MCU 之间通信机制
* 通过 共享内存 + mailbox 实现轻量消息传递
* 在 Linux 上通过 rpmsg 驱动提供用户空间接口

**使用场景：智能无人小车**

```arduino

                ┌────────────┐
                │  Linux / ROS│
                │ (RK3562)    │
                │ SLAM / AI   │
                └─────▲──────┘
                      │
           Ethernet / UART / CAN
                      │
        ┌─────────────┴─────────────┐
        │      MCU / RTOS            │
        │  电机 / 编码器 / IMU       │
        │  PID / 急停 / 避障底层     │
        └───────────────────────────┘

```

**Linux / RK：**

* SLAM
* 路径规划
* 视觉
* 调度
* OTA / UI

**RTOS / MCU：**

* 电机控制（1kHz+）
* 编码器
* 急停
* 低层避障
* 安全

### 外挂 MCU vs RK AMP（M 核 RTOS）

| 对比维度           | 外挂 MCU（推荐）                  | RK AMP（M 核 RTOS）    |
| -------------- | --------------------------- | ------------------- |
| **典型形态**       | RK3562 + STM32 / GD32 / NXP | RK3562 内部 A 核 + M 核 |
| **系统结构**       | 双芯片，硬隔离                     | 单芯片，软隔离             |
| **实时性**        | ⭐⭐⭐⭐⭐（极稳）                   | ⭐⭐⭐⭐                |
| **确定性 / 抖动**   | 极低                          | 可控但存在               |
| **Linux 崩溃影响** | 不影响 MCU                     | 可能影响 RTOS           |
| **急停 / 安全**    | 最优（独立）                      | 风险更高                |
| **看门狗设计**      | 简单、可靠                       | 复杂                  |
| **调试难度**       | 低（SWD/JTAG）                 | 高（双系统 + AMP）        |
| **开发效率**       | 高                           | 低                   |
| **维护成本**       | 低                           | 高                   |
| **量产稳定性**      | ⭐⭐⭐⭐⭐                       | ⭐⭐⭐                 |
| **客户 / 甲方接受度** | 高（工业常态）                     | 低                   |
| **功能安全 / 认证**  | 易做                          | 难                   |
| **BOM 成本**     | +几元～十几元                     | 极限最低                |
| **PCB 复杂度**    | 略高                          | 最低                  |
| **EMC / EMI**  | 好控制                         | 更难                  |
| **适合产品**       | 分拣线、AGV、AMR、工控              | Demo、极限成本消费级        |
| **工程推荐度**      | **★★★★★**                   | **★★**              |

## 以太网驱动

**调试步骤**

硬件 → DTS → 内核驱动 → PHY → MAC ↔ PHY → 网络栈 → 用户态

**硬件排查**

* PHY 供电是否正常（1.0V / 1.8V / 2.5V / 3.3V）
* PHY 时钟： 25MHz / 50MHz / 125MHz 是否有
* PHY 复位脚：上电是否拉低 → 延时 → 拉高
* MAC ↔ PHY 接口：RGMII / RMII / MII 是否与 DTS 一致
* 网口指示灯：插网线是否亮 / 闪

![rk3562_xt_gmac](/images/driver/rk3562_xt_gmac.png)

供电 → 复位 → 时钟 → PHY 自举 → MDIO → Link → RGMII

## Altium Viewer

[Altium 365 Viewer](https://viewer.altium365.com.cn/viewer/)

Altium Viewer 是官方发布的浏览器查看工具，由 Altium 公司提供，用于查看 PCB/原理图等设计文件，而无需安装 Altium Designer 等付费软件





















